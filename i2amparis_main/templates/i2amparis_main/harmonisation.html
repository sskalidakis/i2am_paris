{% extends "base_template_harmonisation.html" %}
{% load static %}
{% csrf_token %}
{% block css %}

    <style>
        .heading {
            font-weight: 500;
            font-size: 0.9em;
        }

        .heading a {
            font-size: 0.9em;
        }

        .desc_text {
            font-size: 0.8em;
        }

        .take_up_space {
            min-height: 1em;
            margin-bottom: 0.5em;
        }

        .text_take_up_space {
            min-height: 10em;
            margin-bottom: 1em;
        }

        td {
            font-size: 0.8em;
            background-color: rgba(246, 250, 238, 0.5);
            color: #2a2a2e;
        }

        td.light-grey {
            font-weight: bold;
        }

        label {
            font-size: 1em;
        }


    </style>
    <link rel="stylesheet" href={% static "doc_css.css" %}>
    <link rel="stylesheet" href={% static "detailed_doc_css.css" %}>
{% endblock %}

{% block content %}
    <div class="tab-content">
        <div class="tab-pane" id="harm_heatmap">
            <div class="container" style="width: 100%; height:100%;">
                <div class="row" style="margin-top: 6em; height: 130vh">
                    <div class="col-sm-9 col-xs-12" style="height: 100%">
                        <div id="viz_frame_div" class="row" style="height: 100%; line-height: 100%;">
                            <iframe id="viz_iframe" src="" title="Harmonisation Table Heatmap Chart"
                                    style="width: 100%; height: 100%;  border:none"></iframe>
                            <div id="loading_bar"
                                 style=" height:100%;vertical-align: middle; text-align: center; position: relative; top:30%;margin-top:-6em; display: none">
                                <img class="row" style="height: 13em; width: 13em; margin-bottom: 2em"
                                     src="{% static "gifs/loading-dots.gif" %}" alt="Loading...">
                                <div class="row" style="font-size: 0.9em ; margin-left: 2em; margin-right: 2em;">
                                    <div class="col-sm-2"></div>
                                    <div class="col-sm-8">This heatmap indicates how
                                        different variables are handled across the models within the
                                        Paris Reinforce consortium. The rows present the different socio and techno
                                        economic
                                        variables. The columns indicate the 16 PR models. Variables are either
                                        considered as outputs
                                        from models, inputs to models or are not represented by the models as any
                                        explicit output or
                                        input
                                    </div>
                                    <div class="col-sm-2"></div>
                                </div>
                                <div class="heading" style="font-size: 1.5em; margin:3em">Loading...</div>
                            </div>
                        </div>
                    </div>


                    <div class="col-sm-3 col-xs-12" style="margin-top: 1.5em">
                        <div class="tooltip-demo">
                            <h4 style="display: inline-block;background:transparent;box-shadow: none; font-weight: bold; color: #828f30; cursor: help"
                                data-toggle="tooltip" data-placement="auto"
                                title="<p>This heatmap indicates how different variables are handled across the models within the Paris Reinforce consortium. The rows present the different socio and techno economic variables. The columns indicate the 16 PR models. Variables are either considered as outputs from models, inputs to models or are not represented by the models as any explicit output or input</p>">
                                Variable Harmonisation Heatmap
                            </h4>
                        </div>
                        <div style="margin-bottom: 3em;">
                            <label style="display: block;width: 70%">
                                Order Columns By:
                                <select id="col_order" class="form-control">
                                    <option value="default">Default</option>
                                    <option value="title">Alphabetically</option>
                                    <option value="type">Model Type</option>
                                    <option value="coverage">Geographical Coverage</option>
                                    <option value="time_steps_in_solution">Time Step</option>
                                </select>
                            </label>
{#                            <label style="display: block;width: 70%">#}
{#                                Order Rows By:#}
{#                                <select id="row_order" class="form-control">#}
{#                                    <option value="default">Default</option>#}
{#                                    <option value="title">Alphabetically</option>#}
{#                                    <option value="category">Variable Category</option>#}
{#                                </select>#}
{#                            </label>#}
                        </div>

                        <label for="model_name" style="display: block;width: 70%">Model Name
                            <select class="form-control desc_text take_up_space" id="model_name">
                                {% for el in models %}
                                    <option value="{{ el.model_name }}">{{ el.model_title }}</option>
                                {% endfor %}
                            </select>
                        </label>
                        <div class="heading">Model Geographical Coverage</div>
                        <div class="desc_text take_up_space" id="geo_cov"></div>
                        <div class="heading">Model Type</div>
                        <div class="desc_text take_up_space" id="model_type"></div>
                        <div class="heading"> Model Time Step (Years)</div>
                        <div class="desc_text take_up_space" id="model_timestep"></div>
                        <div class="heading">
                            <a style="font-weight: bold; " id="model_desc" target="_blank"
                               rel="noopener noreferrer" href="/detailed_model_doc/">Detailed Model
                                Documentation
                                <i class="fa fa-book"></i>
                            </a>
                        </div>
                        <div class="heading " style="margin-bottom: 1em">
                            <a style="font-weight: bold; " id="model_dynamic" target="_blank"
                               rel="noopener noreferrer" href="/dynamic_doc/">Dynamic Model
                                Documentation
                                <i class="fa fa-search"></i>
                            </a>
                        </div>

                        {#                <div class="desc_text text_take_up_space" id="model_desc"></div>#}
                        {#                <hr>#}
                        {#                <div class="heading">Variable Name</div>#}
                        <label for="var_name" style="display: block;width: 70%">Variable Name
                            <select class=" form-control desc_text take_up_space" id="var_name">
                                {% for el in variables %}
                                    <option value="{{ el.var_name }}">{{ el.var_title }}</option>
                                {% endfor %}
                            </select>
                        </label>
                        <div class="heading"> Category</div>
                        <div class="desc_text take_up_space" id="var_cat"></div>
                        <div class="heading">Variable Definition</div>
                        <div class="desc_text take_up_space" id="var_def"></div>
                        <div class = "source_container">
                            <div class="heading">Source</div>
                            <div class="desc_text take_up_space" id="var_mod_source"></div>
                        </div>
                        <div class="unit_container">
                            <div class="heading">Unit</div>
                            <div class="desc_text take_up_space" id="var_mod_unit"></div>
                        </div>
                        <div class="timespan_container">
                            <div class="heading">Timespan</div>
                            <div class="desc_text take_up_space" id="var_mod_timespan"></div>
                        </div>

                    </div>
                </div>

            </div>
            <div id="models_container" style="display: none">
                {% for model in models %}
                    <div id={{ model.model_name }}>
                        {#                <span id="long_title">{{ model.long_title }}</span>#}
                        <span class="d_model_coverage">{{ model.coverage_title }}</span>
                        <span class="d_model_type">{{ model.type_of_model }}</span>
                        <span class="d_model_timestep">{{ model.time_steps_in_solution }}</span>
                        <span class="d_model_description">{{ model.short_description }}</span>
                    </div>
                {% endfor %}
            </div>
            <div id="variables_container" style="display: none">
                {% for variable in variables %}
                    <div id={{ variable.var_name }}>
                        <span class="d_var_title">{{ variable.var_title }}</span>
                        <span class="d_var_category">{{ variable.var_category }}</span>
                        <span class="d_var_definition">{{ variable.var_definition }}</span>
                    </div>
                {% endfor %}
            </div>
            <div id="var_mod_data_container" style="display: none">
                {% for el in var_mod %}
                    <div id={{ el.model }}_{{ el.var }}>
                        <span class="d_var_mod_unit">{{ el.var_unit }}</span>
                        <span class="d_var_mod_source_info">{{ el.var_source_info }}</span>
                        <span class="d_var_mod_timespan">{{ el.var_timespan }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>


        <div class="tab-pane" id="harm_tables">
            <div class="container" style="width: 70%; height:100%;">
                <div class="row" style="margin-top: 6em;">

                    {% include "i2amparis_main/harm_table_wp5.html" %}
                    {% include "i2amparis_main/harm_table_wp6.html" %}
                    {% include "i2amparis_main/harm_table_wp7.html" %}


                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block js %}

    <script>
        $(document).ready(function () {
            $('body').tooltip({container:'body', html:true, selector: '[data-toggle=tooltip]', placement:'auto'});
            setTimeout(timer, 10);

            function timer() {
                $('a[href="#harm_heatmap"]').tab('show');
            }

            $(function () {
                $('#myTab a:last').tab('show')
            })
        });

    </script>

    <script>

        $("#col_order,#row_order").change(function () {
            var viz_frame = $('#viz_iframe');
            viz_frame.hide();
            $('#loading_bar').show();

            var data = {
                "row_categorisation_dataset": "datasetvariableharmonisationguides",
                "col_order": $('#col_order').val(),
                "row_order": $('#row_order').val(),
                "y_var_names": ["harmonisation_variable"],
                "y_axis_title": "Variables",
                "y_var_units": ["-"],
                "x_axis_name": "harmonisation_model",
                "x_axis_title": "Models",
                "x_axis_unit": "-",
                "z_axis_name": "harmonisation_io_status",
                "z_axis_title": "Value",
                "z_axis_unit": "-",
                "min_max_z_value": 0,
                "color_list_request": ["grey_green", "light_blue", "ice_gray"],
                "distinct": ["Extractable model output", "Interlinkable model input", "No explicit output or input"],
                "dataset": "i2amparis_main_datasetvariableharmonisation",
                "dataset_type": "db",
            };
            var url = '';
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    if (Array.isArray(data[key])) {
                        for (var j = 0; j < data[key].length; j++) {
                            url = url + String(key) + '[]' + "=" + String(data[key][j]) + '&'
                        }
                    } else {
                        url = url + String(key) + "=" + String(data[key]) + '&'
                    }

                }
            }

            var complete_url = "/visualiser/show_heat_map_chart?" + url;
            viz_frame.attr('src', complete_url);
            viz_frame.load(function () {
                $(this).show();

                $('#loading_bar').hide();
                $(this).contents().on('click', function () {

                    var col_option = $('iframe').contents().find('#col_clicked').text();
                    var col_val = $('#model_name option')
                        .filter(function () {
                            return $.trim($(this).text()) === col_option;
                        }).val();
                    $('#model_name').val(col_val);
                    $('#model_name').trigger('change');
                    var row_option = $('iframe').contents().find('#row_clicked').text();
                    var row_val = $('#var_name option')
                        .filter(function () {
                            return $.trim($(this).text()) === row_option;
                        }).val();
                    $('#var_name').val(row_val);
                    $('#var_name').trigger('change');
                })
            });


        });
        $('#col_order').val('default').trigger('change');
    </script>

    <script>

    var sel_model_name = $("#model_name");
    var sel_geo_cov = $('#geo_cov');
    var sel_model_type = $('#model_type');
    var sel_model_timestep = $('#model_timestep');
    var sel_model_desc = $('#model_desc');
    var sel_model_dynamic = $('#model_dynamic');
    var sel_var_mod_unit = $('#var_mod_unit');
    var sel_var_mod_source = $('#var_mod_source');
    var sel_var_mod_timespan = $('#var_mod_timespan');
    var sel_var_name = $("#var_name");
    var sel_var_def = $('#var_def');
    var sel_var_cat = $('#var_cat');
    var sel_unit_container = $('.unit_container');
    var sel_source_container = $('.source_container');
    var sel_timespan_container = $('.timespan_container');

    function show_hide_empty_fields() {
        if (sel_var_mod_unit.text() === '') {
            sel_unit_container.hide();
        } else {
            sel_unit_container.show();
        }
        if (sel_var_mod_source.text() === '') {
            sel_source_container.hide();
        } else {
            sel_source_container.show();
        }
        if (sel_var_mod_timespan.text() === '') {
            sel_timespan_container.hide();
        } else {
            sel_timespan_container.show();
        }
    }

        sel_model_name.change(function () {
            sel_geo_cov.text($('#' + String($(this).val()) + ' .d_model_coverage').text());
            sel_model_type.text($('#' + String($(this).val()) + ' .d_model_type').text());
            sel_model_timestep.text($('#' + String($(this).val()) + ' .d_model_timestep').text());
            sel_model_desc.attr('href', '/detailed_model_doc/' + String($(this).val()));
            sel_model_dynamic.attr('href', '/dynamic_doc/' + String($('#model_name').val()));
            sel_model_desc.html("<i class=\"fa fa-book\"></i> Detailed Documentation of " + String($(this).find('option:selected').text()));
            sel_model_dynamic.html("<i class=\"fa fa-search\"></i> Dynamic Documentation of " + String($(this).find('option:selected').text()));
            sel_var_mod_unit.text($('#' + String(sel_model_name.val()) + '_'+ String(sel_var_name.val()) + ' .d_var_mod_unit').text());
            sel_var_mod_source.text($('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_source_info').text());
            sel_var_mod_timespan.text($('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_timespan').text());
            show_hide_empty_fields();
            console.log(('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_unit'));
        });
        sel_var_name.change(function () {
            sel_var_def.text($('#' + String($(this).val()) + ' .d_var_definition').text());
            sel_var_cat.text($('#' + String($(this).val()) + ' .d_var_category').text());
            sel_var_mod_unit.text($('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_unit').text());
            sel_var_mod_source.text($('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_source_info').text());
            sel_var_mod_timespan.text($('#' + String(sel_model_name.val()) + '_' + String(sel_var_name.val()) + ' .d_var_mod_timespan').text());
            show_hide_empty_fields();

        });
        sel_model_desc.attr('href', '/detailed_model_doc/' + String(sel_model_name.val()));
        sel_geo_cov.text($('#' + String(sel_model_name.val()) + ' .d_model_coverage').text());
        sel_model_type.text($('#' + String(sel_model_name.val()) + ' .d_model_type').text());
        sel_model_timestep.text($('#' + String(sel_model_name.val()) + ' .d_model_timestep').text());
        sel_model_dynamic.attr('href', '/dynamic_doc/' + String(sel_model_name.val()));
        sel_model_desc.html("<i class=\"fa fa-book\"></i> Detailed Documentation of " + String(sel_model_name.find('option:selected').text()));
        sel_model_dynamic.html("<i class=\"fa fa-search\"></i> Dynamic Documentation of " + String(sel_model_name.find('option:selected').text()));
        sel_var_def.text($('#' + String(sel_var_name.val()) + ' .d_var_definition').text());
        sel_var_cat.text($('#' + String(sel_var_name.val()) + ' .d_var_category').text());
        show_hide_empty_fields();

    </script>



{% endblock %}






