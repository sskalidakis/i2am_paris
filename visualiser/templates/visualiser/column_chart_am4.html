{% extends 'visualiser/main_visualiser_am4.html' %}
{% block content %}
    <div id="chartdiv"></div>
    <script>
        am4core.ready(function () {


            var chart = am4core.create("chartdiv", am4charts.XYChart3D);

            // Themes begin
            am4core.useTheme(am4themes_animated);

// Add data
            chart.data = {{ chart_data |safe}};
            var x_axis_title = "{{x_axis_title}}";
            var x_axis_name = "{{ x_axis_name }}";
            var x_axis_unit = "{{ x_axis_unit }}";
            var y_var_names = {{ y_var_names|safe}};
            var y_var_titles = {{ y_var_titles|safe}};
            var y_var_units = {{ y_var_units|safe }};
            var y_axis_title = "{{ y_axis_title }}";

// Create axes
            var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
            categoryAxis.dataFields.category = x_axis_name;
            categoryAxis.renderer.grid.template.location = 0;
            categoryAxis.renderer.minGridDistance = 30;
            categoryAxis.title.text = x_axis_title + " (" + x_axis_unit + ")";
            categoryAxis.title.fontWeight = 600;

            var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
            valueAxis.title.fontWeight = 600 ;
            valueAxis.renderer.labels.template.adapter.add("text", function (text) {
                return text + "%";
            });
            valueAxis.title.text = y_axis_title + " (" + y_var_units[0] + ")";
            valueAxis.title.fontWeight = 600;

        // Create series

            // Create series
            var series = [];
            for (var i = 0; i < y_var_names.length; i++) {
                series[i] = create_series(x_axis_name + "_" + String(i), y_var_names[i], i, y_var_titles[i],
                    y_var_units[i], y_axis_title,x_axis_name);
            }

            //Add Legend
            chart.legend = new am4charts.Legend();
            chart.legend.useDefaultMarker = true;
            var marker = chart.legend.markers.template.children.getIndex(0);
            marker.cornerRadius(5, 5, 5, 5);
            marker.strokeWidth = 2;
            marker.strokeOpacity = 1;
            marker.stroke = am4core.color("#ccc");
            var markerTemplate = chart.legend.markers.template;
            markerTemplate.width = 25;
            markerTemplate.height = 25;


            // Add scrollbar
            chart.scrollbarX = new am4charts.XYChartScrollbar();
            chart.scrollbarX.series.push(series[0]);

            function create_series(setNameOfX, myVar, fillColor,  myVarTitle, myVarUnit, y_axis_title, x_axis_name) {
                <!-- Set the range  between open and close and set and the close-->

                var series = chart.series.push(new am4charts.ColumnSeries3D());
                series.dataFields.valueY = myVar;
                series.dataFields.categoryX = x_axis_name;
                series.name = myVarTitle;
                series.clustered = false;
                series.columns.template.tooltipText = y_axis_title+"- {categoryX}- "+myVarTitle+" : [bold]{valueY}[/]";
                series.columns.template.fillOpacity = 0.5;
                series.columns.template.width = am4core.percent(60);

                {#series.yAxis = valueAxis;#}

                //legend shows value dynamically
                series.legendSettings.labelText = "{name}";
                {#series.legendSettings.itemValueText = "[bold]{value}[/bold]";#}
                return series


            }


        }); // end am4core.ready()
    </script>
{% endblock %}

